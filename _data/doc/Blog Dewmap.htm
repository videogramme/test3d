<!DOCTYPE html>
<!-- saved from url=(0052)http://blog.dewmap.com/post/50f61b8a9f9b0d0200000001 -->
<html lang="en" ng-app="myApp" class="ng-scope"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>Blog Dewmap</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="http://blog.dewmap.com/libs/bootstrap/css/bootstrap.css" rel="stylesheet">
    <style type="text/css">
        body {
            padding-top: 60px;
            padding-bottom: 40px;
        }
    </style>
    <link href="http://blog.dewmap.com/libs/bootstrap/css/bootstrap-responsive.css" rel="stylesheet">
    <link rel="stylesheet" href="http://blog.dewmap.com/stylesheets/screen.css">
    <link rel="stylesheet" href="http://blog.dewmap.com/libs/prettify/prettify.css">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

<style type="text/css"></style><style type="text/css">@charset "UTF-8";[ng\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak{display:none;}ng\:form{display:block;}</style><link type="text/css" rel="stylesheet" href="chrome-extension://dagdlcijhfbmgkjokkjicnnfimlebcll/style.css"><script type="text/javascript" charset="utf-8" src="chrome-extension://dagdlcijhfbmgkjokkjicnnfimlebcll/page_context.js"></script><style>[touch-action="none"]{ -ms-touch-action: none; touch-action: none; }[touch-action="pan-x"]{ -ms-touch-action: pan-x; touch-action: pan-x; }[touch-action="pan-y"]{ -ms-touch-action: pan-y; touch-action: pan-y; }[touch-action="scroll"],[touch-action="pan-x pan-y"],[touch-action="pan-y pan-x"]{ -ms-touch-action: pan-x pan-y; touch-action: pan-x pan-y; }</style><style id="style-1-cropbar-clipper">/* Copyright 2014 Evernote Corporation. All rights reserved. */
.en-markup-crop-options {
    top: 18px !important;
    left: 50% !important;
    margin-left: -90px !important;
    width: 180px !important;
    border: 2px rgba(255,255,255,.38) solid !important;
    border-radius: 4px !important;
}

.en-markup-crop-options div div:first-of-type {
    margin-left: 0px !important;
}
</style><script type="text/javascript" async="" src="./Blog Dewmap_files/embed.js"></script></head>

<body ng-controller="MainCtrl" class="ng-scope" screen_capture_injected="true" cz-shortcut-listen="true">

<div class="navbar navbar-inverse navbar-fixed-top ng-scope" ng-controller="NavCtrl">
    <div class="navbar-inner">
        <div class="container">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse" href="">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>
            <a class="brand" href="http://blog.dewmap.com/post">Dewmap</a>

            <div class="nav-collapse collapse">
                <ul class="nav">
                    <li><a href="http://blog.dewmap.com/post">Posts</a></li>
                    <li><a href="http://blog.dewmap.com/about">About</a></li>
                </ul>
                <form name="myForm" class="navbar-form pull-right ng-pristine ng-invalid ng-invalid-required">
                    <div ng-show="!postService.isLoggedIn">
                        <button class="btn" type="button" ng-click="showLogin = true" ng-show="!showLogin">Sign-in</button>
                        <div ng-show="showLogin" style="display: none;">
                            <div>
                                <input class="span2 ng-pristine ng-invalid ng-invalid-required" type="text" placeholder="Name" name="username" ng-model="user.username" required="">
                                <input class="span2 ng-pristine ng-invalid ng-invalid-required" type="password" placeholder="Password" name="password" ng-model="user.password" required="">
                                <button type="submit" class="btn" ng-click="onSubmit(user)" ng-disabled="myForm.$invalid" disabled="disabled">Submit</button>
                            </div>
                        </div>
                    </div>
                    <div ng-show="postService.isLoggedIn" style="display: none;">
                        <button class="btn pull-right" type="button" ng-click="postService.onLogout()">Logout</button>
                    </div>
                </form>
            </div>
            <!--/.nav-collapse -->
        </div>
    </div>
</div>

<div class="container">
    <div id="notifications"></div>
    <ng-view><section id="post" ng-controller="PostCtrl" class="ng-scope">
    <button ng-click="postService.onEdit(post._id)" class="btn btn-primary" ng-show="postService.isLoggedIn" style="display: none;">
        <i class="icon-edit"></i> Edit
    </button>
    <article>
        <div class="page-header">
            <h1 class="ng-binding">Facebook Open Graph + D3 + AngularJS</h1>
        </div>
        <p class="lead">
            <time class="ng-binding">Jan 16 2013</time>
        </p>
        <div my-attr="post.text"><p><img src="./Blog Dewmap_files/screen-shot.jpg" alt="screen-shot" title=""></p>

<h2 id="theexperimentconsistsof">The experiment consists of:</h2>

<ul>
<li>Connecting to the FB OpenGraph API.</li>
<li>Creating a network of my mutual friends connections.</li>
<li>Connecting D3 and AngularJS. </li>
</ul>

<p><a href="http://dewmap.com/#/experiment/fb-og-d3">Demo</a> | <a href="https://github.com/Bretto/dewmap/tree/master/public/experiment/fb-og-d3">Source</a></p>

<h3 id="facebookandangularjs">Facebook and AngularJS</h3>

<p>One way to integrate Facebook in a AngularJS app is to create a Facebook service that can be injected where you need it. For this, in my case, I had to resolve an async issues between the initialisation of the default FB object and the initialisation of my app. To fix this, I manually bootstrap the app when the default FB is loaded.</p>

<h4 id="angularjsbootstrapandfacebook">AngularJS bootstrap and Facebook</h4>

<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><code class=""><span class="pln">angular</span><span class="pun">.</span><span class="pln">element</span><span class="pun">(</span><span class="pln">document</span><span class="pun">).</span><span class="pln">ready</span><span class="pun">(</span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class=""></code></li><li class="L2"><code class=""><span class="pln">    window</span><span class="pun">.</span><span class="pln">fbAsyncInit </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code class=""><span class="pln">        </span><span class="com">// init the FB JS SDK</span></code></li><li class="L4"><code class=""><span class="pln">        FB</span><span class="pun">.</span><span class="pln">init</span><span class="pun">({</span></code></li><li class="L5"><code class=""><span class="pln">            appId      </span><span class="pun">:</span><span class="pln"> </span><span class="str">'101201093309709'</span><span class="pun">,</span><span class="pln"> </span><span class="com">// App ID from the App Dashboard</span></code></li><li class="L6"><code class=""><span class="com">//                    channelUrl : '//WWW.YOUR_DOMAIN.COM/channel.html', // Channel File for x-domain communication</span></code></li><li class="L7"><code class=""><span class="pln">            status     </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln"> </span><span class="com">// check the login status upon init?</span></code></li><li class="L8"><code class=""><span class="pln">            cookie     </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln"> </span><span class="com">// set sessions cookies to allow your server to access the session?</span></code></li><li class="L9"><code class=""><span class="pln">            xfbml      </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">  </span><span class="com">// parse XFBML tags on this page?</span></code></li><li class="L0"><code class=""><span class="pln">        </span><span class="pun">});</span></code></li><li class="L1"><code class=""></code></li><li class="L2"><code class=""><span class="pln">        </span><span class="com">// Additional initialization code such as adding Event Listeners goes here</span></code></li><li class="L3"><code class=""><span class="pln">        angular</span><span class="pun">.</span><span class="pln">bootstrap</span><span class="pun">(</span><span class="str">'#fb-og-d3'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="str">'fb-og-d3'</span><span class="pun">]);</span></code></li><li class="L4"><code class=""><span class="pln">    </span><span class="pun">};</span></code></li><li class="L5"><code class=""></code></li><li class="L6"><code class=""><span class="pln">    </span><span class="com">// Load the SDK's source Asynchronously</span></code></li><li class="L7"><code class=""><span class="pln">    </span><span class="com">// Note that the debug version is being actively developed and might</span></code></li><li class="L8"><code class=""><span class="pln">    </span><span class="com">// contain some type checks that are overly strict.</span></code></li><li class="L9"><code class=""><span class="pln">    </span><span class="com">// Please report such bugs using the bugs tool.</span></code></li><li class="L0"><code class=""><span class="pln">    </span><span class="kwd">function</span><span class="pln"> loadFB</span><span class="pun">(</span><span class="pln">d</span><span class="pun">,</span><span class="pln"> debug</span><span class="pun">){</span></code></li><li class="L1"><code class=""><span class="pln">        </span><span class="kwd">var</span><span class="pln"> js</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">=</span><span class="pln"> </span><span class="str">'facebook-jssdk'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">ref</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> d</span><span class="pun">.</span><span class="pln">getElementsByTagName</span><span class="pun">(</span><span class="str">'script'</span><span class="pun">)[</span><span class="lit">0</span><span class="pun">];</span></code></li><li class="L2"><code class=""><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">d</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="pln">id</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="kwd">return</span><span class="pun">;}</span></code></li><li class="L3"><code class=""><span class="pln">        js </span><span class="pun">=</span><span class="pln"> d</span><span class="pun">.</span><span class="pln">createElement</span><span class="pun">(</span><span class="str">'script'</span><span class="pun">);</span><span class="pln"> js</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> id</span><span class="pun">;</span><span class="pln"> js</span><span class="pun">.</span><span class="pln">async </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></code></li><li class="L4"><code class=""><span class="pln">        js</span><span class="pun">.</span><span class="pln">src </span><span class="pun">=</span><span class="pln"> </span><span class="str">"//connect.facebook.net/en_US/all"</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="pun">(</span><span class="pln">debug </span><span class="pun">?</span><span class="pln"> </span><span class="str">"/debug"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">""</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="str">".js"</span><span class="pun">;</span></code></li><li class="L5"><code class=""><span class="pln">        </span><span class="kwd">ref</span><span class="pun">.</span><span class="pln">parentNode</span><span class="pun">.</span><span class="pln">insertBefore</span><span class="pun">(</span><span class="pln">js</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">ref</span><span class="pun">);</span></code></li><li class="L6"><code class=""><span class="pln">    </span><span class="pun">}</span></code></li><li class="L7"><code class=""></code></li><li class="L8"><code class=""><span class="pln">    loadFB</span><span class="pun">(</span><span class="pln">document</span><span class="pun">,</span><span class="pln"> </span><span class="com">/*debug*/</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">)</span></code></li><li class="L9"><code class=""></code></li><li class="L0"><code class=""><span class="pun">});</span></code></li></ol></pre>

<h4 id="theinjectablefacebookservices">The (injectable) Facebook services</h4>

<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><code class=""><span class="pln">services</span><span class="pun">.</span><span class="pln">service</span><span class="pun">(</span><span class="str">'facebook'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="str">'$rootScope'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'$window'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$rootScope</span><span class="pun">,</span><span class="pln"> $window</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class=""></code></li><li class="L2"><code class=""><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">askFacebookForAuthentication </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">fail</span><span class="pun">,</span><span class="pln"> success</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code class=""><span class="pln">        FB</span><span class="pun">.</span><span class="pln">login</span><span class="pun">(</span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">response</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code class=""><span class="pln">            $rootScope</span><span class="pun">.</span><span class="pln">$apply</span><span class="pun">(</span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code class=""><span class="pln">                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">response</span><span class="pun">.</span><span class="pln">authResponse</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code class=""><span class="pln">                    FB</span><span class="pun">.</span><span class="pln">api</span><span class="pun">(</span><span class="str">'/me'</span><span class="pun">,</span><span class="pln"> success</span><span class="pun">);</span></code></li><li class="L7"><code class=""><span class="pln">                </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8"><code class=""><span class="pln">                    fail</span><span class="pun">(</span><span class="str">'User cancelled login or did not fully authorize.'</span><span class="pun">);</span></code></li><li class="L9"><code class=""><span class="pln">                </span><span class="pun">}</span></code></li><li class="L0"><code class=""><span class="pln">            </span><span class="pun">});</span></code></li><li class="L1"><code class=""><span class="pln">        </span><span class="pun">});</span></code></li><li class="L2"><code class=""><span class="pln">    </span><span class="pun">};</span></code></li><li class="L3"><code class=""></code></li><li class="L4"><code class=""><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">getLoginStatus </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code class=""><span class="pln">        FB</span><span class="pun">.</span><span class="pln">getLoginStatus</span><span class="pun">(</span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">response</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code class=""><span class="pln">            </span><span class="kwd">return</span><span class="pln"> response</span><span class="pun">;</span></code></li><li class="L7"><code class=""><span class="pln">        </span><span class="pun">});</span></code></li><li class="L8"><code class=""><span class="pln">    </span><span class="pun">};</span></code></li><li class="L9"><code class=""></code></li><li class="L0"><code class=""><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">FB </span><span class="pun">=</span><span class="pln"> $window</span><span class="pun">.</span><span class="pln">FB</span><span class="pun">;</span></code></li><li class="L1"><code class=""></code></li><li class="L2"><code class=""><span class="pun">}]);</span></code></li><li class="L3"><code class=""></code></li><li class="L4"><code class=""><span class="com">/* --------------- FB API MODELS ------------------ */</span></code></li><li class="L5"><code class=""><span class="pln">services</span><span class="pun">.</span><span class="pln">service</span><span class="pun">(</span><span class="str">'FBUser'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="str">'$log'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'$rootScope'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'facebook'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$log</span><span class="pun">,</span><span class="pln"> $rootScope</span><span class="pun">,</span><span class="pln"> facebook</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code class=""><span class="pln">    </span><span class="kwd">var</span><span class="pln"> that </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">;</span></code></li><li class="L7"><code class=""></code></li><li class="L8"><code class=""><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">authorized </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span></code></li><li class="L9"><code class=""></code></li><li class="L0"><code class=""><span class="pln">    facebook</span><span class="pun">.</span><span class="pln">FB</span><span class="pun">.</span><span class="typ">Event</span><span class="pun">.</span><span class="pln">subscribe</span><span class="pun">(</span><span class="str">'auth.authResponseChange'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">response</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class=""><span class="pln">        $log</span><span class="pun">.</span><span class="pln">info</span><span class="pun">(</span><span class="str">"Event: auth.authResponseChange"</span><span class="pun">);</span></code></li><li class="L2"><code class=""><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">response</span><span class="pun">.</span><span class="pln">authResponse</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code class=""><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">response</span><span class="pun">.</span><span class="pln">status </span><span class="pun">===</span><span class="pln"> </span><span class="str">'connected'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code class=""><span class="pln">                </span><span class="com">// User logged in and authorized</span></code></li><li class="L5"><code class=""><span class="pln">                $log</span><span class="pun">.</span><span class="pln">info</span><span class="pun">(</span><span class="str">'User logged in and authorized'</span><span class="pun">);</span></code></li><li class="L6"><code class=""><span class="pln">                $rootScope</span><span class="pun">.</span><span class="pln">$apply</span><span class="pun">(</span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code class=""><span class="pln">                    that</span><span class="pun">.</span><span class="pln">authorized </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></code></li><li class="L8"><code class=""><span class="pln">                </span><span class="pun">});</span></code></li><li class="L9"><code class=""><span class="pln">                </span><span class="com">// DO WORK</span></code></li><li class="L0"><code class=""><span class="pln">            </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">response</span><span class="pun">.</span><span class="pln">status </span><span class="pun">===</span><span class="pln"> </span><span class="str">'not_authorized'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class=""><span class="pln">                </span><span class="com">// User logged in but has not authorized app</span></code></li><li class="L2"><code class=""><span class="pln">                $log</span><span class="pun">.</span><span class="pln">info</span><span class="pun">(</span><span class="str">'User logged in'</span><span class="pun">);</span></code></li><li class="L3"><code class=""><span class="pln">                $rootScope</span><span class="pun">.</span><span class="pln">$apply</span><span class="pun">(</span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code class=""><span class="pln">                    that</span><span class="pun">.</span><span class="pln">authorized </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span></code></li><li class="L5"><code class=""><span class="pln">                </span><span class="pun">});</span></code></li><li class="L6"><code class=""><span class="pln">            </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code class=""><span class="pln">                </span><span class="com">// User logged out</span></code></li><li class="L8"><code class=""><span class="pln">                $log</span><span class="pun">.</span><span class="pln">info</span><span class="pun">(</span><span class="str">'User logged out'</span><span class="pun">);</span></code></li><li class="L9"><code class=""><span class="pln">                $rootScope</span><span class="pun">.</span><span class="pln">$apply</span><span class="pun">(</span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0"><code class=""><span class="pln">                    that</span><span class="pun">.</span><span class="pln">authorized </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span></code></li><li class="L1"><code class=""><span class="pln">                </span><span class="pun">});</span></code></li><li class="L2"><code class=""><span class="pln">            </span><span class="pun">}</span></code></li><li class="L3"><code class=""><span class="pln">        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code class=""><span class="pln">            $log</span><span class="pun">.</span><span class="pln">info</span><span class="pun">(</span><span class="str">'No valid authResponse found, user logged out'</span><span class="pun">);</span></code></li><li class="L5"><code class=""><span class="pln">            $rootScope</span><span class="pun">.</span><span class="pln">$apply</span><span class="pun">(</span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code class=""><span class="pln">                that</span><span class="pun">.</span><span class="pln">authorized </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span></code></li><li class="L7"><code class=""><span class="pln">            </span><span class="pun">});</span></code></li><li class="L8"><code class=""><span class="pln">        </span><span class="pun">}</span></code></li><li class="L9"><code class=""><span class="pln">    </span><span class="pun">});</span></code></li><li class="L0"><code class=""></code></li><li class="L1"><code class=""><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">login </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">success</span><span class="pun">,</span><span class="pln"> fail</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code class=""><span class="pln">        facebook</span><span class="pun">.</span><span class="pln">FB</span><span class="pun">.</span><span class="pln">login</span><span class="pun">(</span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">response</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code class=""><span class="pln">            $rootScope</span><span class="pun">.</span><span class="pln">$apply</span><span class="pun">(</span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code class=""><span class="pln">                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">response</span><span class="pun">.</span><span class="pln">authResponse</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code class=""><span class="pln">                    success</span><span class="pun">(</span><span class="pln">response</span><span class="pun">);</span></code></li><li class="L6"><code class=""><span class="pln">                </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code class=""><span class="pln">                    fail</span><span class="pun">(</span><span class="str">'Login unsuccessful'</span><span class="pun">);</span></code></li><li class="L8"><code class=""><span class="pln">                </span><span class="pun">}</span></code></li><li class="L9"><code class=""><span class="pln">            </span><span class="pun">});</span></code></li><li class="L0"><code class=""><span class="pln">        </span><span class="pun">});</span></code></li><li class="L1"><code class=""><span class="pln">    </span><span class="pun">};</span></code></li><li class="L2"><code class=""></code></li><li class="L3"><code class=""><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">logout </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code class=""><span class="pln">        facebook</span><span class="pun">.</span><span class="pln">FB</span><span class="pun">.</span><span class="pln">logout</span><span class="pun">(</span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code class=""><span class="pln">            $rootScope</span><span class="pun">.</span><span class="pln">$apply</span><span class="pun">(</span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code class=""><span class="pln">                that</span><span class="pun">.</span><span class="pln">authorized </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span></code></li><li class="L7"><code class=""><span class="pln">            </span><span class="pun">});</span></code></li><li class="L8"><code class=""><span class="pln">        </span><span class="pun">});</span></code></li><li class="L9"><code class=""><span class="pln">    </span><span class="pun">};</span></code></li><li class="L0"><code class=""><span class="pun">}]);</span></code></li></ol></pre>

<p>Now you can inject FBUser in your controller, expose it on the scope and make use of the login / logout methods and the authorized flag to show or hide relevant UI.</p>

<h4 id="controllerwithfacebookapi">Controller with Facebook API</h4>

<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><code class=""><span class="pln">controllers</span><span class="pun">.</span><span class="pln">controller</span><span class="pun">(</span><span class="str">'MainCtrl'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$scope</span><span class="pun">,</span><span class="pln"> $http</span><span class="pun">,</span><span class="pln"> $timeout</span><span class="pun">,</span><span class="pln"> $compile</span><span class="pun">,</span><span class="pln"> $log</span><span class="pun">,</span><span class="pln"> </span><span class="typ">AppModel</span><span class="pun">,</span><span class="pln"> </span><span class="typ">FBUser</span><span class="pun">){</span></code></li><li class="L1"><code class=""></code></li><li class="L2"><code class=""><span class="pln">    $log</span><span class="pun">.</span><span class="pln">info</span><span class="pun">(</span><span class="str">'MainCtrl'</span><span class="pun">);</span></code></li><li class="L3"><code class=""></code></li><li class="L4"><code class=""><span class="pln">    $scope</span><span class="pun">.</span><span class="pln">appModel </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AppModel</span><span class="pun">;</span></code></li><li class="L5"><code class=""><span class="pln">    $scope</span><span class="pun">.</span><span class="pln">user </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FBUser</span><span class="pun">;</span></code></li><li class="L6"><code class=""></code></li><li class="L7"><code class=""><span class="pln">    </span><span class="kwd">function</span><span class="pln"> loginSuccess</span><span class="pun">(){</span></code></li><li class="L8"><code class=""><span class="pln">        $log</span><span class="pun">.</span><span class="pln">info</span><span class="pun">(</span><span class="str">'Success'</span><span class="pun">);</span></code></li><li class="L9"><code class=""><span class="pln">        getMe</span><span class="pun">()</span></code></li><li class="L0"><code class=""><span class="pln">    </span><span class="pun">}</span></code></li><li class="L1"><code class=""></code></li><li class="L2"><code class=""><span class="pln">    </span><span class="kwd">function</span><span class="pln"> loginFail</span><span class="pun">(){</span></code></li><li class="L3"><code class=""><span class="pln">        $log</span><span class="pun">.</span><span class="pln">info</span><span class="pun">(</span><span class="str">'Fail'</span><span class="pun">);</span></code></li><li class="L4"><code class=""><span class="pln">    </span><span class="pun">}</span></code></li><li class="L5"><code class=""></code></li><li class="L6"><code class=""></code></li><li class="L7"><code class=""><span class="pln">    $scope</span><span class="pun">.</span><span class="pln">onLogin </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(){</span></code></li><li class="L8"><code class=""><span class="pln">        </span><span class="typ">FBUser</span><span class="pun">.</span><span class="pln">login</span><span class="pun">(</span><span class="pln">loginSuccess</span><span class="pun">,</span><span class="pln"> loginFail</span><span class="pun">)</span></code></li><li class="L9"><code class=""><span class="pln">    </span><span class="pun">}</span></code></li><li class="L0"><code class=""></code></li><li class="L1"><code class=""><span class="pln">    $scope</span><span class="pun">.</span><span class="pln">onLogout </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(){</span></code></li><li class="L2"><code class=""><span class="pln">        </span><span class="typ">FBUser</span><span class="pun">.</span><span class="pln">logout</span><span class="pun">();</span></code></li><li class="L3"><code class=""><span class="pln">        $log</span><span class="pun">.</span><span class="pln">info</span><span class="pun">(</span><span class="str">'Logged Out'</span><span class="pun">);</span></code></li><li class="L4"><code class=""><span class="pln">    </span><span class="pun">}</span></code></li><li class="L5"><code class=""></code></li><li class="L6"><code class=""></code></li><li class="L7"><code class=""><span class="pln">    </span><span class="kwd">function</span><span class="pln"> getMe</span><span class="pun">(){</span></code></li><li class="L8"><code class=""><span class="pln">        FB</span><span class="pun">.</span><span class="pln">api</span><span class="pun">(</span><span class="str">'me'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">response</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code class=""><span class="pln">            $log</span><span class="pun">.</span><span class="pln">info</span><span class="pun">(</span><span class="pln">response</span><span class="pun">);</span></code></li><li class="L0"><code class=""><span class="pln">            </span><span class="typ">AppModel</span><span class="pun">.</span><span class="pln">me </span><span class="pun">=</span><span class="pln"> response</span><span class="pun">;</span></code></li><li class="L1"><code class=""><span class="pln">        </span><span class="pun">});</span></code></li><li class="L2"><code class=""><span class="pln">    </span><span class="pun">}</span></code></li><li class="L3"><code class=""></code></li><li class="L4"><code class=""><span class="pln">    </span><span class="kwd">function</span><span class="pln"> getMutualFriends</span><span class="pun">(</span><span class="kwd">friend</span><span class="pun">,</span><span class="pln">cb</span><span class="pun">){</span></code></li><li class="L5"><code class=""><span class="pln">        FB</span><span class="pun">.</span><span class="pln">api</span><span class="pun">(</span><span class="typ">AppModel</span><span class="pun">.</span><span class="pln">me</span><span class="pun">.</span><span class="pln">id </span><span class="pun">+</span><span class="pln"> </span><span class="str">'?fields=mutualfriends.user('</span><span class="pun">+</span><span class="pln"> </span><span class="kwd">friend</span><span class="pun">.</span><span class="pln">id </span><span class="pun">+</span><span class="str">')'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">response</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code class=""><span class="pln">            </span><span class="com">//$log.info(response);</span></code></li><li class="L7"><code class=""><span class="pln">            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">response</span><span class="pun">.</span><span class="pln">mutualfriends</span><span class="pun">){</span></code></li><li class="L8"><code class=""><span class="pln">                </span><span class="kwd">friend</span><span class="pun">.</span><span class="pln">mutualfriends </span><span class="pun">=</span><span class="pln"> response</span><span class="pun">.</span><span class="pln">mutualfriends</span><span class="pun">.</span><span class="pln">data</span><span class="pun">;</span></code></li><li class="L9"><code class=""><span class="pln">            </span><span class="pun">}</span></code></li><li class="L0"><code class=""><span class="pln">            cb</span><span class="pun">();</span></code></li><li class="L1"><code class=""></code></li><li class="L2"><code class=""><span class="pln">        </span><span class="pun">});</span></code></li><li class="L3"><code class=""><span class="pln">    </span><span class="pun">}</span></code></li><li class="L4"><code class=""></code></li><li class="L5"><code class=""><span class="pln">    $scope</span><span class="pun">.</span><span class="pln">getFriends </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(){</span></code></li><li class="L6"><code class=""></code></li><li class="L7"><code class=""><span class="pln">        </span><span class="kwd">var</span><span class="pln"> </span><span class="kwd">done</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L8"><code class=""></code></li><li class="L9"><code class=""><span class="pln">        FB</span><span class="pun">.</span><span class="pln">api</span><span class="pun">(</span><span class="typ">AppModel</span><span class="pun">.</span><span class="pln">me</span><span class="pun">.</span><span class="pln">id </span><span class="pun">+</span><span class="pln"> </span><span class="str">'?fields=friends'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">response</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0"><code class=""><span class="pln">            $log</span><span class="pun">.</span><span class="pln">info</span><span class="pun">(</span><span class="pln">response</span><span class="pun">);</span></code></li><li class="L1"><code class=""><span class="pln">            </span><span class="kwd">var</span><span class="pln"> friends </span><span class="pun">=</span><span class="pln"> response</span><span class="pun">.</span><span class="pln">friends</span><span class="pun">.</span><span class="pln">data</span><span class="pun">;</span></code></li><li class="L2"><code class=""><span class="pln">            </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> friends</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code class=""><span class="pln">                </span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">i</span><span class="pun">){</span></code></li><li class="L4"><code class=""><span class="pln">                    </span><span class="kwd">var</span><span class="pln"> </span><span class="kwd">friend</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> friends</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span></code></li><li class="L5"><code class=""><span class="com">//                    $log.info(friend);</span></code></li><li class="L6"><code class=""><span class="pln">                    getMutualFriends</span><span class="pun">(</span><span class="kwd">friend</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(){</span></code></li><li class="L7"><code class=""><span class="pln">                        </span><span class="com">//$log.info(done, friends.length);</span></code></li><li class="L8"><code class=""></code></li><li class="L9"><code class=""><span class="pln">                        </span><span class="com">// limit the friends count</span></code></li><li class="L0"><code class=""><span class="pln">                        </span><span class="kwd">var</span><span class="pln"> cnt </span><span class="pun">=</span><span class="pln"> </span><span class="lit">100</span><span class="pun">;</span></code></li><li class="L1"><code class=""><span class="pln">                        </span><span class="kwd">if</span><span class="pun">(</span><span class="kwd">done</span><span class="pln"> </span><span class="pun">===</span><span class="pln"> cnt</span><span class="pun">-</span><span class="lit">1</span><span class="pun">){</span></code></li><li class="L2"><code class=""><span class="pln">                            friends</span><span class="pun">.</span><span class="pln">length </span><span class="pun">=</span><span class="pln"> cnt</span><span class="pun">;</span></code></li><li class="L3"><code class=""><span class="pln">                        </span><span class="pun">}</span></code></li><li class="L4"><code class=""></code></li><li class="L5"><code class=""><span class="pln">                        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln"> </span><span class="pun">++</span><span class="kwd">done</span><span class="pln"> </span><span class="pun">===</span><span class="pln"> friends</span><span class="pun">.</span><span class="pln">length</span><span class="pun">){</span></code></li><li class="L6"><code class=""><span class="pln">                            $log</span><span class="pun">.</span><span class="pln">info</span><span class="pun">(</span><span class="pln">friends</span><span class="pun">);</span></code></li><li class="L7"><code class=""></code></li><li class="L8"><code class=""></code></li><li class="L9"><code class=""><span class="pln">                            </span><span class="typ">AppModel</span><span class="pun">.</span><span class="pln">friends </span><span class="pun">=</span><span class="pln"> friends</span><span class="pun">;</span></code></li><li class="L0"><code class=""><span class="pln">                            $scope</span><span class="pun">.</span><span class="pln">$digest</span><span class="pun">();</span></code></li><li class="L1"><code class=""><span class="pln">                        </span><span class="pun">}</span></code></li><li class="L2"><code class=""><span class="pln">                    </span><span class="pun">});</span></code></li><li class="L3"><code class=""><span class="pln">                </span><span class="pun">}(</span><span class="pln">i</span><span class="pun">));</span></code></li><li class="L4"><code class=""><span class="pln">            </span><span class="pun">}</span></code></li><li class="L5"><code class=""><span class="pln">        </span><span class="pun">});</span></code></li><li class="L6"><code class=""><span class="pln">    </span><span class="pun">}</span></code></li></ol></pre>

<p>Use of the authorized flag on your html template to show / hide UI.</p>

<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><code><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"btn btn-info"</span><span class="pln"> </span><span class="atn">ng-hide</span><span class="pun">=</span><span class="atv">"user.authorized"</span><span class="pln"> </span><span class="atn">ng-click</span><span class="pun">=</span><span class="atv">"onLogin()"</span><span class="tag">&gt;</span><span class="pln">Login with Facebook</span><span class="tag">&lt;/div&gt;</span></code></li><li class="L1"><code><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"btn btn-info"</span><span class="pln"> </span><span class="atn">ng-show</span><span class="pun">=</span><span class="atv">"user.authorized"</span><span class="pln"> </span><span class="atn">ng-click</span><span class="pun">=</span><span class="atv">"onLogout()"</span><span class="tag">&gt;</span><span class="pln">Logout</span><span class="tag">&lt;/div&gt;</span></code></li></ol></pre>

<h2 id="nowthatwehaveaccesstoourdataletsvisualiseitwithd3">Now that we have access to our data let's visualise it with D3.</h2>

<p>D3 relies on SVG for its visualisation, we want to link the D3 svg elements to the AngularJS lifecycle. For this we need to let AngularJS control all the DOM element instansiation and manipulations. A nice way of achieving just this is to use a combination of Directive and NG-Repeat.</p>

<h4 id="thenodedirectivetemplate">The Node Directive &amp; Template</h4>

<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><code class=""><span class="pln">directives</span><span class="pun">.</span><span class="pln">directive</span><span class="pun">(</span><span class="str">'node'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$log</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class=""><span class="pln">    </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code class=""><span class="pln">        replace</span><span class="pun">:</span><span class="kwd">true</span><span class="pun">,</span></code></li><li class="L3"><code class=""><span class="pln">        restrict</span><span class="pun">:</span><span class="str">'E'</span><span class="pun">,</span></code></li><li class="L4"><code class=""><span class="pln">        templateUrl</span><span class="pun">:</span><span class="str">'/experiment/fb-og-d3/partial/node.html'</span><span class="pun">,</span></code></li><li class="L5"><code class=""><span class="pln">        link</span><span class="pun">:</span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">scope</span><span class="pun">,</span><span class="pln"> elem</span><span class="pun">,</span><span class="pln"> attr</span><span class="pun">,</span><span class="pln"> ctrl</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code class=""><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">scope</span><span class="pun">.</span><span class="pln">$last </span><span class="pun">===</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code class=""><span class="pln">                scope</span><span class="pun">.</span><span class="pln">renderComplete</span><span class="pun">();</span></code></li><li class="L8"><code class=""><span class="pln">            </span><span class="pun">}</span></code></li><li class="L9"><code class=""><span class="pln">        </span><span class="pun">}</span></code></li><li class="L0"><code class=""><span class="pln">    </span><span class="pun">}</span></code></li><li class="L1"><code class=""><span class="pun">});</span></code></li></ol></pre>

<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><code><span class="tag">&lt;svg</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"node-svg"</span><span class="pln"> </span><span class="atn">ng-mouseenter</span><span class="pun">=</span><span class="atv">"onMouseEnter($event)"</span><span class="pln"> </span><span class="atn">ng-mouseleave</span><span class="pun">=</span><span class="atv">"onMouseLeave($event)"</span><span class="pln"> </span><span class="atn">node-id</span><span class="pun">=</span><span class="atv">"{{friend.id}}"</span><span class="tag">&gt;</span></code></li><li class="L1"><code><span class="pln">     </span><span class="tag">&lt;circle</span><span class="pln"> </span><span class="atn">cx</span><span class="pun">=</span><span class="atv">"6"</span><span class="pln"> </span><span class="atn">cy</span><span class="pun">=</span><span class="atv">"6"</span><span class="pln"> </span><span class="atn">r</span><span class="pun">=</span><span class="atv">"5"</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"node"</span><span class="tag">&gt;&lt;/circle&gt;</span></code></li><li class="L2"><code><span class="pln">     </span><span class="tag">&lt;text</span><span class="pln"> </span><span class="atn">ng-show</span><span class="pun">=</span><span class="atv">"showName"</span><span class="pln"> </span><span class="atn">x</span><span class="pun">=</span><span class="atv">"15"</span><span class="pln"> </span><span class="atn">y</span><span class="pun">=</span><span class="atv">"12"</span><span class="tag">&gt;</span><span class="pln">{{friend.name}}</span><span class="tag">&lt;/text&gt;</span></code></li><li class="L3"><code><span class="tag">&lt;/svg&gt;</span></code></li></ol></pre>

<p>When all the nodes have been instantiated, the node directive calls on its current scope the method renderComplete that is declared at the controller level. This method is accessible on the node scope due to the prototypical inheritance <a href="http://docs.angularjs.org/guide/scope">Scope</a>.
The SVG is a special type of html tag and AngularJS in not ment to be working within an SVG tag. To resolve this every node elements is wrapped in an SVG tag it self. </p>

<h4 id="lettingangularjscontrollingthedom">Letting AngularJS Controlling the DOM</h4>

<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><code><span class="tag">&lt;svg</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"nodes"</span><span class="pln"> </span><span class="atn">width</span><span class="pun">=</span><span class="atv">"960"</span><span class="pln"> </span><span class="atn">height</span><span class="pun">=</span><span class="atv">"600"</span><span class="tag">&gt;</span></code></li><li class="L1"><code><span class="pln">    </span><span class="tag">&lt;node</span><span class="pln"> </span><span class="atn">ng-repeat</span><span class="pun">=</span><span class="atv">"friend in appModel.friends"</span><span class="tag">&gt;&lt;/node&gt;</span></code></li><li class="L2"><code><span class="tag">&lt;/svg&gt;</span></code></li></ol></pre>

<p>The idea here is to configure D3 the "normal" way but not using the <code>.enter().append("node")</code> as this is being handled by ng-repeat.</p>

<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><code class=""><span class="pln">$scope</span><span class="pun">.</span><span class="pln">renderComplete </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class=""></code></li><li class="L2"><code class=""><span class="pln">        graph </span><span class="pun">=</span></code></li><li class="L3"><code class=""><span class="pln">        </span><span class="pun">{</span></code></li><li class="L4"><code class=""><span class="pln">            </span><span class="str">"nodes"</span><span class="pun">:</span><span class="pln"> </span><span class="typ">AppModel</span><span class="pun">.</span><span class="pln">friends</span><span class="pun">,</span></code></li><li class="L5"><code class=""><span class="pln">            </span><span class="str">"links"</span><span class="pun">:</span><span class="pln"> makeLinks</span><span class="pun">(</span><span class="typ">AppModel</span><span class="pun">.</span><span class="pln">friends</span><span class="pun">)</span></code></li><li class="L6"><code class=""><span class="pln">        </span><span class="pun">};</span></code></li><li class="L7"><code class=""></code></li><li class="L8"><code class=""><span class="pln">        </span><span class="kwd">var</span><span class="pln"> width </span><span class="pun">=</span><span class="pln"> </span><span class="lit">960</span><span class="pun">,</span></code></li><li class="L9"><code class=""><span class="pln">            height </span><span class="pun">=</span><span class="pln"> </span><span class="lit">600</span><span class="pun">;</span></code></li><li class="L0"><code class=""></code></li><li class="L1"><code class=""><span class="pln">        </span><span class="kwd">var</span><span class="pln"> force </span><span class="pun">=</span><span class="pln"> d3</span><span class="pun">.</span><span class="pln">layout</span><span class="pun">.</span><span class="pln">force</span><span class="pun">()</span></code></li><li class="L2"><code class=""><span class="pln">            </span><span class="pun">.</span><span class="pln">charge</span><span class="pun">(-</span><span class="lit">100</span><span class="pun">)</span></code></li><li class="L3"><code class=""><span class="pln">            </span><span class="pun">.</span><span class="pln">linkDistance</span><span class="pun">(</span><span class="lit">100</span><span class="pun">)</span></code></li><li class="L4"><code class=""><span class="pln">            </span><span class="pun">.</span><span class="pln">size</span><span class="pun">([</span><span class="pln">width</span><span class="pun">,</span><span class="pln"> height</span><span class="pun">]);</span></code></li><li class="L5"><code class=""></code></li><li class="L6"><code class=""><span class="pln">        </span><span class="kwd">var</span><span class="pln"> svg </span><span class="pun">=</span><span class="pln"> d3</span><span class="pun">.</span><span class="kwd">select</span><span class="pun">(</span><span class="str">"svg"</span><span class="pun">);</span></code></li><li class="L7"><code class=""></code></li><li class="L8"><code class=""><span class="pln">        force</span></code></li><li class="L9"><code class=""><span class="pln">            </span><span class="pun">.</span><span class="pln">nodes</span><span class="pun">(</span><span class="pln"> graph</span><span class="pun">.</span><span class="pln">nodes </span><span class="pun">)</span></code></li><li class="L0"><code class=""><span class="pln">            </span><span class="pun">.</span><span class="pln">links</span><span class="pun">(</span><span class="pln"> graph</span><span class="pun">.</span><span class="pln">links </span><span class="pun">)</span></code></li><li class="L1"><code class=""><span class="pln">            </span><span class="pun">.</span><span class="pln">start</span><span class="pun">();</span></code></li><li class="L2"><code class=""></code></li><li class="L3"><code class=""><span class="pln">        </span><span class="kwd">var</span><span class="pln"> link </span><span class="pun">=</span><span class="pln"> svg</span><span class="pun">.</span><span class="pln">selectAll</span><span class="pun">(</span><span class="str">"line.link"</span><span class="pun">)</span></code></li><li class="L4"><code class=""><span class="pln">            </span><span class="pun">.</span><span class="pln">data</span><span class="pun">(</span><span class="pln">graph</span><span class="pun">.</span><span class="pln">links</span><span class="pun">)</span></code></li><li class="L5"><code class=""><span class="pln">            </span><span class="pun">.</span><span class="pln">enter</span><span class="pun">().</span><span class="pln">append</span><span class="pun">(</span><span class="str">"line"</span><span class="pun">)</span></code></li><li class="L6"><code class=""><span class="pln">            </span><span class="pun">.</span><span class="pln">attr</span><span class="pun">(</span><span class="str">"class"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"link"</span><span class="pun">)</span></code></li><li class="L7"><code class=""><span class="pln">            </span><span class="pun">.</span><span class="pln">style</span><span class="pun">(</span><span class="str">"stroke-width"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">d</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">sqrt</span><span class="pun">(</span><span class="pln">d</span><span class="pun">.</span><span class="pln">value</span><span class="pun">);</span><span class="pln"> </span><span class="pun">});</span></code></li><li class="L8"><code class=""></code></li><li class="L9"><code class=""><span class="pln">        </span><span class="kwd">var</span><span class="pln"> node </span><span class="pun">=</span><span class="pln"> svg</span><span class="pun">.</span><span class="pln">selectAll</span><span class="pun">(</span><span class="str">"svg.node-svg"</span><span class="pun">)</span></code></li><li class="L0"><code class=""><span class="pln">            </span><span class="pun">.</span><span class="pln">data</span><span class="pun">(</span><span class="typ">AppModel</span><span class="pun">.</span><span class="pln">friends</span><span class="pun">)</span></code></li><li class="L1"><code class=""><span class="pln">            </span><span class="pun">.</span><span class="pln">call</span><span class="pun">(</span><span class="pln">force</span><span class="pun">.</span><span class="pln">drag</span><span class="pun">);</span></code></li><li class="L2"><code class=""></code></li><li class="L3"><code class=""><span class="pln">        force</span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">"tick"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code class=""><span class="pln">            link</span><span class="pun">.</span><span class="pln">attr</span><span class="pun">(</span><span class="str">"link-id"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">d</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> d</span><span class="pun">.</span><span class="pln">sourceId</span><span class="pun">;</span><span class="pln"> </span><span class="pun">})</span></code></li><li class="L5"><code class=""><span class="pln">                </span><span class="pun">.</span><span class="pln">attr</span><span class="pun">(</span><span class="str">"x1"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">d</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> d</span><span class="pun">.</span><span class="pln">source</span><span class="pun">.</span><span class="pln">x </span><span class="pun">+</span><span class="pln"> </span><span class="lit">6</span><span class="pun">;</span><span class="pln"> </span><span class="pun">})</span></code></li><li class="L6"><code class=""><span class="pln">                </span><span class="pun">.</span><span class="pln">attr</span><span class="pun">(</span><span class="str">"y1"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">d</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> d</span><span class="pun">.</span><span class="pln">source</span><span class="pun">.</span><span class="pln">y </span><span class="pun">+</span><span class="pln"> </span><span class="lit">6</span><span class="pun">;</span><span class="pln"> </span><span class="pun">})</span></code></li><li class="L7"><code class=""><span class="pln">                </span><span class="pun">.</span><span class="pln">attr</span><span class="pun">(</span><span class="str">"x2"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">d</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> d</span><span class="pun">.</span><span class="pln">target</span><span class="pun">.</span><span class="pln">x </span><span class="pun">+</span><span class="pln"> </span><span class="lit">6</span><span class="pun">;</span><span class="pln"> </span><span class="pun">})</span></code></li><li class="L8"><code class=""><span class="pln">                </span><span class="pun">.</span><span class="pln">attr</span><span class="pun">(</span><span class="str">"y2"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">d</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> d</span><span class="pun">.</span><span class="pln">target</span><span class="pun">.</span><span class="pln">y </span><span class="pun">+</span><span class="pln"> </span><span class="lit">6</span><span class="pun">;</span><span class="pln"> </span><span class="pun">});</span></code></li><li class="L9"><code class=""></code></li><li class="L0"><code class=""><span class="pln">            node</span><span class="pun">.</span><span class="pln">attr</span><span class="pun">(</span><span class="str">"x"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">d</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> d</span><span class="pun">.</span><span class="pln">x</span><span class="pun">;</span><span class="pln"> </span><span class="pun">})</span></code></li><li class="L1"><code class=""><span class="pln">                </span><span class="pun">.</span><span class="pln">attr</span><span class="pun">(</span><span class="str">"y"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">d</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> d</span><span class="pun">.</span><span class="pln">y</span><span class="pun">;</span><span class="pln"> </span><span class="pun">});</span></code></li><li class="L2"><code class=""><span class="pln">        </span><span class="pun">});</span></code></li><li class="L3"><code class=""><span class="pln">    </span><span class="pun">}</span></code></li></ol></pre></div>
    </article>
    <div id="disqus_thread"><iframe id="dsq-2" data-disqus-uid="2" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" width="100%" src="./Blog Dewmap_files/saved_resource.htm" style="width: 100% !important; border: none !important; overflow: hidden !important; height: 384px !important;" horizontalscrolling="no" verticalscrolling="no"></iframe></div>
      <noscript>Please enable JavaScript to view the &lt;a href="http://disqus.com/?ref_noscript"&gt;comments powered by Disqus.&lt;/a&gt;</noscript>
    

</section></ng-view>
</div>
<!-- /container -->

<script type="text/javascript" async="" src="./Blog Dewmap_files/ga.js"></script><script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-36896737-2']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

</script>

<script type="text/javascript" src="./Blog Dewmap_files/prettify.js"></script>
<script src="./Blog Dewmap_files/jquery-1.7.2.min.js"></script>
<script src="./Blog Dewmap_files/bootstrap.js"></script>
<script src="./Blog Dewmap_files/angular.js"></script>
<script src="./Blog Dewmap_files/angular-resource.js"></script>
<script src="./Blog Dewmap_files/hammer.js"></script>
<script src="./Blog Dewmap_files/showdown.js"></script>
<!--<script src="/libs/moment.min.js"></script>-->
<script src="./Blog Dewmap_files/vos.js"></script>
<script src="./Blog Dewmap_files/app.js"></script>
<script src="./Blog Dewmap_files/services.js"></script>
<script src="./Blog Dewmap_files/controllers.js"></script>
<script src="./Blog Dewmap_files/filters.js"></script>
<script src="./Blog Dewmap_files/directives.js"></script>



</body></html>